<main class="container my-4">
  <h2>Checkout</h2>

  <%= form_with model: @order, url: complete_checkout_cart_path, local: true, data: { turbo: false } do |f| %>
    <div class="form-group">
      <%= f.label :address_street, 'Street Address' %>
      <%= f.text_field :address_street, class: 'form-control', value: current_user.address_street, required: true %>
    </div>

    <div class="form-group">
      <%= f.label :address_city, 'City' %>
      <%= f.text_field :address_city, class: 'form-control', value: current_user.address_city, required: true %>
    </div>

    <div class="form-group">
      <%= f.label :address_state, 'State' %>
      <%= f.text_field :address_state, class: 'form-control', value: current_user.address_state, required: true %>
    </div>

    <div class="form-group">
      <%= f.label :address_zip_code, 'Zip Code' %>
      <%= f.text_field :address_zip_code, class: 'form-control', value: current_user.address_zip_code, required: true %>
    </div>

    <div class="form-group">
      <%= f.label :province, 'Province' %>
      <%= f.select :province, options_for_select(provinces_list), { include_blank: 'Select Province' }, class: 'form-control', required: true %>
    </div>

    <h3>Items in Your Cart</h3>
    <table class="table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <% if @cart_items.present? %>
          <% @cart_items.each do |item| %>
            <tr>
              <td><%= item.product.name %></td>
              <td><%= item.quantity %></td>
              <td><%= number_to_currency(item.product.price) %></td>
              <td><%= number_to_currency(item.product.price * item.quantity) %></td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="4">No items in cart</td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div class="form-group">
      <strong>Total: <%= number_to_currency(@cart_total) %></strong>
    </div>

    <div class="form-group">
      <%= f.submit 'Complete Order', class: 'btn btn-primary' %>
    </div>
  <% end %>
</main>
